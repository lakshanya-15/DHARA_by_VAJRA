// Same schema as dharaa so we use the same PostgreSQL database.
// Generator uses prisma-client-js for Node.js (JavaScript) backend.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Asset {
  id                 String           @id @default(uuid()) @db.Uuid
  name               String
  type               String
  category           AssetCategory    @default(SOIL_PREPARATION)
  priceperday        Decimal          @db.Decimal(10, 2)
  availability       Boolean?         @default(true)
  ownerid            String           @db.Uuid
  maintenanceDueDate DateTime?        @db.Date
  createdat          DateTime?        @default(now()) @db.Timestamp(6)
  User               User             @relation(fields: [ownerid], references: [id], onUpdate: NoAction, map: "fk_asset_owner")
  Booking            Booking[]
  MaintenanceLog     MaintenanceLog[]
}

model MaintenanceLog {
  id          String   @id @default(uuid()) @db.Uuid
  assetid     String   @db.Uuid
  date        DateTime @db.Date
  type        String // e.g., "Oil Change", "Repair"
  cost        Decimal  @db.Decimal(10, 2)
  notes       String?
  Asset       Asset    @relation(fields: [assetid], references: [id], onUpdate: NoAction)
  createdat   DateTime? @default(now()) @db.Timestamp(6)
}

enum AssetCategory {
  SOIL_PREPARATION
  SOWING
  PLANT_PROTECTION
  HARVESTING
  TRANSPORTATION
  OTHER
}

model Booking {
  id          String         @id @default(uuid()) @db.Uuid
  bookingdate DateTime       @db.Date
  bookingTime String?        // Start time (e.g., "10:30 AM")
  status      booking_status
  farmerid    String         @db.Uuid
  assetid     String         @db.Uuid
  createdat   DateTime?      @default(now()) @db.Timestamp(6)
  Asset       Asset          @relation(fields: [assetid], references: [id], onUpdate: NoAction, map: "fk_booking_asset")
  User        User           @relation(fields: [farmerid], references: [id], onUpdate: NoAction, map: "fk_booking_farmer")

  @@unique([assetid, bookingdate, bookingTime], map: "unique_asset_booking_date_time")
}

model User {
  id        String    @id @default(uuid()) @db.Uuid
  name      String
  email     String    @unique
  password  String
  role      user_role
  village   String?
  district  String?
  state     String?
  lat       Decimal?  @db.Decimal(10, 7)
  lng       Decimal?  @db.Decimal(10, 7)
  createdat DateTime? @default(now()) @db.Timestamp(6)
  Asset     Asset[]
  Booking   Booking[]
  Notification Notification[]
}

model Notification {
  id        String    @id @default(uuid()) @db.Uuid
  userid    String    @db.Uuid
  message   String
  type      String?   @default("INFO")
  isread    Boolean?  @default(false)
  createdat DateTime? @default(now()) @db.Timestamp(6)
  User      User      @relation(fields: [userid], references: [id], onUpdate: NoAction, map: "fk_notification_user")
}

enum booking_status {
  BOOKED
  PENDING
  COMPLETED
  CANCELLED
}

enum user_role {
  FARMER
  OPERATOR
  ADMIN
}
