// Same schema as dharaa so we use the same PostgreSQL database.
// Generator uses prisma-client-js for Node.js (JavaScript) backend.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Asset {
  id           String    @id @default(uuid()) @db.Uuid
  name         String
  type         String
  priceperday  Decimal   @db.Decimal(10, 2)
  availability Boolean?  @default(true)
  ownerid      String    @db.Uuid
  createdat    DateTime? @default(now()) @db.Timestamp(6)
  User         User      @relation(fields: [ownerid], references: [id], onUpdate: NoAction, map: "fk_asset_owner")
  Booking      Booking[]
}

model Booking {
  id          String         @id @default(uuid()) @db.Uuid
  bookingdate DateTime       @db.Date
  status      booking_status
  farmerid    String         @db.Uuid
  assetid     String         @db.Uuid
  createdat   DateTime?      @default(now()) @db.Timestamp(6)
  Asset       Asset          @relation(fields: [assetid], references: [id], onUpdate: NoAction, map: "fk_booking_asset")
  User        User           @relation(fields: [farmerid], references: [id], onUpdate: NoAction, map: "fk_booking_farmer")

  @@unique([assetid, bookingdate], map: "unique_asset_booking_date")
}

model User {
  id        String    @id @default(uuid()) @db.Uuid
  name      String
  email     String    @unique
  password  String
  role      user_role
  village   String?
  district  String?
  state     String?
  createdat DateTime? @default(now()) @db.Timestamp(6)
  Asset     Asset[]
  Booking   Booking[]
  Notification Notification[]
}

model Notification {
  id        String    @id @default(uuid()) @db.Uuid
  userid    String    @db.Uuid
  message   String
  type      String?   @default("INFO")
  isread    Boolean?  @default(false)
  createdat DateTime? @default(now()) @db.Timestamp(6)
  User      User      @relation(fields: [userid], references: [id], onUpdate: NoAction, map: "fk_notification_user")
}

enum booking_status {
  BOOKED
  COMPLETED
  CANCELLED
}

enum user_role {
  FARMER
  OPERATOR
  ADMIN
}
